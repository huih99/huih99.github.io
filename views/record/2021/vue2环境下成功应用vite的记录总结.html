<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue2环境下成功应用vite的实践总结 | 曾经的你</title>
    <meta name="description" content="看一看世界的繁华">
    <link rel="icon" href="/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.b5500b79.css" as="style"><link rel="preload" href="/assets/js/app.32a77fa1.js" as="script"><link rel="preload" href="/assets/js/5.3db1e33a.js" as="script"><link rel="preload" href="/assets/js/1.1263133a.js" as="script"><link rel="preload" href="/assets/js/31.23b894b7.js" as="script"><link rel="prefetch" href="/assets/js/10.6bf92a39.js"><link rel="prefetch" href="/assets/js/11.d1839701.js"><link rel="prefetch" href="/assets/js/12.717defdf.js"><link rel="prefetch" href="/assets/js/13.aef896cf.js"><link rel="prefetch" href="/assets/js/14.f481325a.js"><link rel="prefetch" href="/assets/js/15.77b15318.js"><link rel="prefetch" href="/assets/js/16.b08e42b8.js"><link rel="prefetch" href="/assets/js/17.6d1a0e09.js"><link rel="prefetch" href="/assets/js/18.e6be9a62.js"><link rel="prefetch" href="/assets/js/19.da1f1a70.js"><link rel="prefetch" href="/assets/js/20.f7120a5d.js"><link rel="prefetch" href="/assets/js/21.7c3b52a5.js"><link rel="prefetch" href="/assets/js/22.94ab8097.js"><link rel="prefetch" href="/assets/js/23.d74a2a32.js"><link rel="prefetch" href="/assets/js/24.f770a461.js"><link rel="prefetch" href="/assets/js/25.a9bc2877.js"><link rel="prefetch" href="/assets/js/26.7153c46a.js"><link rel="prefetch" href="/assets/js/27.5a94d914.js"><link rel="prefetch" href="/assets/js/28.2557607b.js"><link rel="prefetch" href="/assets/js/29.c8d7094b.js"><link rel="prefetch" href="/assets/js/3.04f17590.js"><link rel="prefetch" href="/assets/js/30.7aa5ce47.js"><link rel="prefetch" href="/assets/js/32.bcde2786.js"><link rel="prefetch" href="/assets/js/33.ff121c8f.js"><link rel="prefetch" href="/assets/js/34.704c2113.js"><link rel="prefetch" href="/assets/js/4.7ab9b31c.js"><link rel="prefetch" href="/assets/js/6.92ee8563.js"><link rel="prefetch" href="/assets/js/7.6650276c.js"><link rel="prefetch" href="/assets/js/8.eda84085.js"><link rel="prefetch" href="/assets/js/9.2c11c80b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b5500b79.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container"><div><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/head.jpg" alt="曾经的你" class="logo"> <span class="site-name">曾经的你</span></a> <div class="links"><div class="color-picker"><a href="#" class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><!----> <div class="dark-theme-options toggle-option"><label for="dark-theme-toggle">Enable Dark Theme?</label> <input id="dark-theme-toggle" type="checkbox" checked="checked"></div></div></div></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      文章
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/category/随心.html" class="nav-link"><i class="iconfont undefined"></i>
  随心
</a></li><li class="dropdown-item"><!----> <a href="/category/笔记.html" class="nav-link"><i class="iconfont undefined"></i>
  笔记
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      关注我
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/huih99" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      文章
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/category/随心.html" class="nav-link"><i class="iconfont undefined"></i>
  随心
</a></li><li class="dropdown-item"><!----> <a href="/category/笔记.html" class="nav-link"><i class="iconfont undefined"></i>
  笔记
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      关注我
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/huih99" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>vue2环境下成功应用vite的实践总结</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/record/2021/vue2%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%88%90%E5%8A%9F%E5%BA%94%E7%94%A8vite%E7%9A%84%E8%AE%B0%E5%BD%95%E6%80%BB%E7%BB%93.html#如何正确的引入vue单文件" class="sidebar-link">如何正确的引入vue单文件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/record/2021/vue2%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%88%90%E5%8A%9F%E5%BA%94%E7%94%A8vite%E7%9A%84%E8%AE%B0%E5%BD%95%E6%80%BB%E7%BB%93.html#如何让vite能够解析vue2代码" class="sidebar-link">如何让vite能够解析vue2代码</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/record/2021/vue2%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%88%90%E5%8A%9F%E5%BA%94%E7%94%A8vite%E7%9A%84%E8%AE%B0%E5%BD%95%E6%80%BB%E7%BB%93.html#如何启用jsx语法" class="sidebar-link">如何启用jsx语法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/record/2021/vue2%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%88%90%E5%8A%9F%E5%BA%94%E7%94%A8vite%E7%9A%84%E8%AE%B0%E5%BD%95%E6%80%BB%E7%BB%93.html#问题实录" class="sidebar-link">问题实录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/record/2021/vue2%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%88%90%E5%8A%9F%E5%BA%94%E7%94%A8vite%E7%9A%84%E8%AE%B0%E5%BD%95%E6%80%BB%E7%BB%93.html#一、不要在transition-group子元素上使用index作为key" class="sidebar-link">一、不要在transition-group子元素上使用index作为key</a></li><li class="sidebar-sub-header"><a href="/views/record/2021/vue2%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%88%90%E5%8A%9F%E5%BA%94%E7%94%A8vite%E7%9A%84%E8%AE%B0%E5%BD%95%E6%80%BB%E7%BB%93.html#二、scss无法使用-export导出变量" class="sidebar-link">二、scss无法使用:export导出变量</a></li><li class="sidebar-sub-header"><a href="/views/record/2021/vue2%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%88%90%E5%8A%9F%E5%BA%94%E7%94%A8vite%E7%9A%84%E8%AE%B0%E5%BD%95%E6%80%BB%E7%BB%93.html#三、-ant-design-icons-vue导入报错" class="sidebar-link">三、 @ant-design/icons-vue导入报错</a></li><li class="sidebar-sub-header"><a href="/views/record/2021/vue2%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%88%90%E5%8A%9F%E5%BA%94%E7%94%A8vite%E7%9A%84%E8%AE%B0%E5%BD%95%E6%80%BB%E7%BB%93.html#四、vue模版编译出现多余的空格字符" class="sidebar-link">四、vue模版编译出现多余的空格字符</a></li><li class="sidebar-sub-header"><a href="/views/record/2021/vue2%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%88%90%E5%8A%9F%E5%BA%94%E7%94%A8vite%E7%9A%84%E8%AE%B0%E5%BD%95%E6%80%BB%E7%BB%93.html#五、require-context在vite环境下无法使用" class="sidebar-link">五、require.context在vite环境下无法使用</a></li><li class="sidebar-sub-header"><a href="/views/record/2021/vue2%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%88%90%E5%8A%9F%E5%BA%94%E7%94%A8vite%E7%9A%84%E8%AE%B0%E5%BD%95%E6%80%BB%E7%BB%93.html#六、svg-icon如何使用" class="sidebar-link">六、Svg Icon如何使用</a></li><li class="sidebar-sub-header"><a href="/views/record/2021/vue2%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%88%90%E5%8A%9F%E5%BA%94%E7%94%A8vite%E7%9A%84%E8%AE%B0%E5%BD%95%E6%80%BB%E7%BB%93.html#七、别名配置" class="sidebar-link">七、别名配置</a></li></ul></li><li><a href="/views/record/2021/vue2%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%88%90%E5%8A%9F%E5%BA%94%E7%94%A8vite%E7%9A%84%E8%AE%B0%E5%BD%95%E6%80%BB%E7%BB%93.html#剩余待解决问题" class="sidebar-link">剩余待解决问题</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/record/2021/vue2%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%88%90%E5%8A%9F%E5%BA%94%E7%94%A8vite%E7%9A%84%E8%AE%B0%E5%BD%95%E6%80%BB%E7%BB%93.html#总结" class="sidebar-link">总结</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <div><main class="page reco-hide"> <div class="page-title"><h1>vue2环境下成功应用vite的实践总结</h1> <hr> <div data-v-0b496ca7><i class="iconfont reco-account" data-v-0b496ca7><span data-v-0b496ca7>tanhui</span></i> <i class="iconfont reco-date" data-v-0b496ca7><span data-v-0b496ca7>5/10/2021</span></i> <!----> <i class="iconfont reco-tag tags" data-v-0b496ca7><span class="tag-item" data-v-0b496ca7>
      vue
    </span><span class="tag-item" data-v-0b496ca7>
      vite
    </span></i></div></div> <div class="content__default"><h1 id="vue2环境下成功使用vite的实践总结"><a href="#vue2环境下成功使用vite的实践总结" aria-hidden="true" class="header-anchor">#</a> vue2环境下成功使用vite的实践总结</h1> <p>自从vite发布以来，社区赞誉无数，现在vite也更新到了2.0大版本，我也一直心水vite的极速编译的特性，特别是由于现在项目体积过大，已经严重拖慢了编译和热更新的速度，急需寻找一个解决方案。但无奈官方现在只有支持vue3的插件，而我的项目还是使用的vue2版本，于是我就一直在尝试如何将vite成功应用于vue2项目中，这是这段时间以来实践中总结出的一些问题解决方案，供大家参考。</p> <p>说明： 按我设想的理想方案是：webpack作为打包工具，vite作为开发工具，所以我会考虑到在vite和webpack环境下尽量的维护一份共同配置。</p> <h2 id="如何正确的引入vue单文件"><a href="#如何正确的引入vue单文件" aria-hidden="true" class="header-anchor">#</a> 如何正确的引入vue单文件</h2> <p>在@vue/cli搭建的项目环境中，webpack配置中增加了对<code>.vue</code>文件扩展名的解析，以使我们导入时可以省略<code>.vue</code>后缀，但在vite文档中不建议忽略自定义导入类型的扩展名（例如：.vue），因为它会影响 IDE 和类型支持，所以需要将以前所有没有写明<code>.vue</code>后缀的模块引入都给补上。由于项目庞大，手动去每个文件中更改肯定是不现实的事情，所以我写了一个脚本，在node中执行，自动补全<code>.vue</code>后缀名</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// rewriteImportPath.js</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;chalk&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> overridePaths <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> r <span class="token operator">=</span> <span class="token regex">/(?&lt;!\/\/\s+|\*\s+)(?:im|ex)port (.*?) from &quot;((?:\.{0,2}\/|[^.\s\r\n\t\\\/]+\/)*[^\s\r\n\t\\\/;]+)&quot;|import\((?:\s*\/\*.*?\*\/\s*)?&quot;((?:\.{0,2}\/|[^.\s\r\n\t\\\/]+\/)*[^\s\r\n\t\\\/;]+)&quot;\)/g</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> baseDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> defaultExtensions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;.mjs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.ts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.jsx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.tsx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.json&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">rewritePath</span><span class="token punctuation">(</span><span class="token parameter">baseDir<span class="token punctuation">,</span> rootPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> resolveAlias <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./resolveAlias&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> directory <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>baseDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    directory<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">file</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>baseDir<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> stat <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>stat<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">rewritePath</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/\.vue$|\.jsx?$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> fileContent <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> newFileContent <span class="token operator">=</span> fileContent<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">$$<span class="token punctuation">,</span> $<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">2</span><span class="token punctuation">,</span> $<span class="token number">3</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> importPath<span class="token punctuation">;</span>
          <span class="token keyword">const</span> isDynamicImport <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>$<span class="token number">1</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> modulePath <span class="token operator">=</span> isDynamicImport <span class="token operator">?</span> $<span class="token number">2</span> <span class="token punctuation">:</span> $<span class="token number">3</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>modulePath<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            importPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>baseDir<span class="token punctuation">,</span> modulePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">isAbsolute</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              importPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>rootPath<span class="token punctuation">,</span> modulePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token keyword">const</span> dirLevels <span class="token operator">=</span> modulePath<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">const</span> pathAlias <span class="token operator">=</span> resolveAlias<span class="token punctuation">[</span>dirLevels<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>pathAlias<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                importPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>pathAlias<span class="token punctuation">,</span> <span class="token operator">...</span>dirLevels<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>importPath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> $$<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">let</span> suffix<span class="token punctuation">;</span>
          <span class="token keyword">const</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>importPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> parsedImpPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>importPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
          files<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">file</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> parsedFilePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>
              defaultExtensions<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>parsedFilePath<span class="token punctuation">.</span>ext<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
              parsedFilePath<span class="token punctuation">.</span>name <span class="token operator">===</span> parsedImpPath<span class="token punctuation">.</span>name
            <span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// 修复模块导入的后缀错误</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>
                parsedImpPath<span class="token punctuation">.</span>ext <span class="token operator">===</span> <span class="token string">&quot;.js&quot;</span> <span class="token operator">&amp;&amp;</span>
                parsedFilePath<span class="token punctuation">.</span>ext <span class="token operator">===</span> <span class="token string">&quot;.jsx&quot;</span>
              <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                suffix <span class="token operator">=</span> parsedFilePath<span class="token punctuation">.</span>ext<span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>
              <span class="token operator">!</span>parsedImpPath<span class="token punctuation">.</span>ext <span class="token operator">&amp;&amp;</span>
              parsedFilePath<span class="token punctuation">.</span>ext <span class="token operator">===</span> <span class="token string">&quot;.vue&quot;</span> <span class="token operator">&amp;&amp;</span>
              parsedFilePath<span class="token punctuation">.</span>name <span class="token operator">===</span> parsedImpPath<span class="token punctuation">.</span>name
            <span class="token punctuation">)</span> <span class="token punctuation">{</span>
              suffix <span class="token operator">=</span> <span class="token string">&quot;.vue&quot;</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>suffix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span>dir<span class="token punctuation">,</span>name<span class="token punctuation">}</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span>
            <span class="token keyword">const</span> overridePath <span class="token operator">=</span> $$<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>
              modulePath<span class="token punctuation">,</span>
              <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>suffix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            overridePaths<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;pathRewrite：&quot;</span> <span class="token operator">+</span> $$ <span class="token operator">+</span> <span class="token string">&quot;  &gt;&gt;&gt;  &quot;</span> <span class="token operator">+</span> overridePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> overridePath<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> $$<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileContent <span class="token operator">!==</span> newFileContent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> newFileContent<span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`error in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>baseDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">：\n`</span></span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">rewritePath</span><span class="token punctuation">(</span>baseDir<span class="token punctuation">,</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
overridePaths<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  <span class="token string">&quot;\n✔️ &quot;</span><span class="token punctuation">,</span>
  chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span><span class="token string">&quot;共成功改写&quot;</span> <span class="token operator">+</span> overridePaths<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token string">&quot;条引用路径&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br></div></div><h2 id="如何让vite能够解析vue2代码"><a href="#如何让vite能够解析vue2代码" aria-hidden="true" class="header-anchor">#</a> 如何让vite能够解析vue2代码</h2> <p>vite与vue2搭配使用，主要使用到的插件为<a href="https://github.com/underfin/vite-plugin-vue2" target="_blank" rel="noopener noreferrer">vite-plugin-vue2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，这也是vite文档中推荐适配vue2开发的插件</p> <h2 id="如何启用jsx语法"><a href="#如何启用jsx语法" aria-hidden="true" class="header-anchor">#</a> 如何启用jsx语法</h2> <p>在vite中使用<code>jsx</code>还是稍微有点麻烦的，一是使用到<code>jsx</code>语法的js文件都必须改成使用<code>jsx</code>后缀名，二是在vue的<code>sfc</code>组件中还得加上<code>jsx</code>标识</p> <ol><li><p>首先需要在<code>vite-plugin-vue2</code>中启用<code>jsx</code></p> <p>vite.config.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createVuePlugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite-plugin-vue2&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token function">createVuePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>jsx<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><code>sfc</code>组件中加上<code>jsx</code>标识</p> <p>需要在<strong>script block</strong>中加上<code>lang=jsx</code>的标识</p> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>jsx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token constant">JSX</span> Render<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>另外，由于现在开发vue2项目中基本都是在IDE中使用vetur插件启用vue特性支持，然而当在vue文件中的script标签中加上lang=&quot;jsx&quot;后，无法再使用vetur进行代码格式化，详见此<a href="https://github.com/vuejs/vetur/issues/2781" target="_blank" rel="noopener noreferrer">issue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong></p></li> <li><p>需要将所有使用到<code>jsx</code>语法的js文件后缀名改为<code>.jsx</code></p></li></ol> <p>当<code>vite-plugin-vue2</code>发现有导入的资源是vue类型并且有<code>lang=jsx</code>的标识的时候，就会启用jsx转译，其核心依然是通过<code>babel</code>使用<code>@vue/babel-preset-jsx</code>进行转译,这里有一个坑点需要注意：</p> <p><strong>当使用babel转译的时候，babel会默认搜寻当前项目目录中的babel配置文件，例如<code>babelrc</code>或者<code>babel.config.js</code>,如果当前项目存在着有babel的配置文件，则会在编译<code>jsx</code>语法代码的时候被启用,那么则需要确认配置文件中是否已经包含过@vue/babel-preset-jsx,不能重复添加同一个preset，否则编译会产生错误</strong></p> <p>因为我项目中打算是开发环境使用<code>vite</code>，而生产环境则依然使用webpack进行打包，所以babel配置文件也是不能删除的，解决方案如下：</p> <ol><li><p>如果是使用的babel.config.js文件，通过配置中<code>env</code>决定只在生产模式下才启用配置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  env<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    production<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      presets<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
            <span class="token string">'@vue/app'</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">'useBuiltIns'</span><span class="token punctuation">:</span> <span class="token string">'entry'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>使用<code>.babelrc</code>文件替换<code>babel.config.js</code>，因为<code>vite-plugin-vue2</code>中使用<code>babel</code>时指定了<code>babelrc:false</code>,也就是忽略<code>.babelrc</code>中的配置，避免使用到无关的<code>babel</code>配置。</p> <p>vite-plugin-vue2中的jsxTransform.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">transformVueJsx</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> id<span class="token punctuation">,</span> jsxOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/\.tsx$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@babel/plugin-transform-typescript'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> isTSX<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> allowExtensions<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> core_1<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        presets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@vue/babel-preset-jsx'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> jsxOptions<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        sourceFileName<span class="token punctuation">:</span> id<span class="token punctuation">,</span>
        sourceMaps<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        plugins<span class="token punctuation">,</span>
        babelrc<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        code<span class="token punctuation">:</span> result<span class="token punctuation">.</span>code<span class="token punctuation">,</span>
        map<span class="token punctuation">:</span> result<span class="token punctuation">.</span>map<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li></ol> <p>我给<code>vite-plugin-vue2</code>的作者发起了一个<a href="https://github.com/underfin/vite-plugin-vue2/pull/78" target="_blank" rel="noopener noreferrer">pr<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,在<code>babel.transform</code>中加入<code>configFile:false</code>选项以解决此问题，但是还未被成功采纳。</p> <h2 id="问题实录"><a href="#问题实录" aria-hidden="true" class="header-anchor">#</a> 问题实录</h2> <h3 id="一、不要在transition-group子元素上使用index作为key"><a href="#一、不要在transition-group子元素上使用index作为key" aria-hidden="true" class="header-anchor">#</a> 一、不要在transition-group子元素上使用index作为key</h3> <p>解决方案： 不要在<code>v-for</code>循环中使用<code>index</code>作为key,应替换为唯一值</p> <p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/96e956a8e0444acfa5d83fd9874079d8~tplv-k3u1fbpfcp-watermark.image" alt="image-20210401094139124.png"></p> <h3 id="二、scss无法使用-export导出变量"><a href="#二、scss无法使用-export导出变量" aria-hidden="true" class="header-anchor">#</a> 二、scss无法使用:export导出变量</h3> <p>目前<code>vite</code>不支持<code>:export</code>这种语法：</p> <div class="language-sass line-numbers-mode"><pre class="language-sass"><code><span class="token variable-line"><span class="token variable">$primary</span><span class="token punctuation">:</span> #1890ff</span>
<span class="token property-line"><span class="token punctuation">:</span><span class="token property">export</span> {</span>
<span class="token property-line">    <span class="token property">primary</span><span class="token punctuation">:</span> <span class="token variable">$primary</span></span>
<span class="token selector">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>查找过相应的<a href="https://github.com/vitejs/vite/issues/1279" target="_blank" rel="noopener noreferrer">issue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，尤大说的只会支持sass官方所支持的语法，建议使用<code>css-modules</code>替代。而:export实际并不是sass语法，webpack环境下支持<code>:export</code>这种写法实际是由<strong>css-loader</strong>提供的能力</p> <p>解决方案：启用<strong>css-modules</strong>功能即可，开启<strong>css-modules</strong>功能也很简单，直接将scss文件后缀名改为 <strong>module.scss</strong>即可</p> <h3 id="三、-ant-design-icons-vue导入报错"><a href="#三、-ant-design-icons-vue导入报错" aria-hidden="true" class="header-anchor">#</a> 三、 @ant-design/icons-vue导入报错</h3> <p>在项目中，使用到了<code>ant-design-vue</code>中的几个组件，使用的按需导入方式（通过<a href="https://github.com/onebay/vite-plugin-imp" target="_blank" rel="noopener noreferrer">vite-plugin-imp<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>插件），其内部的图标组件就依赖了<code>@ant-design/icons-vue</code>，报错如下：</p> <p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b87a253d9d345a897f48c8f86cd5d2a~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p> <p>主要原因为：
node_modules\ant-design-vue\es\icon\index.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">...</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> allIcons <span class="token keyword">from</span> <span class="token string">'@ant-design/icons/lib/dist'</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>从<code>@ant-design/icons/lib/dist</code>中导入的<code>allIcons</code>多了一个<code>default</code>的导出项,这是由于vite的<strong>commonjs转es</strong>模块所导致的，所以遍历<code>allIcons</code>的时候遍历到<code>default</code>的时候报错</p> <p>解决方案：</p> <p>不再使用按需导入的方式，而是通过全量引入，直接引用打包编译过后的代码，需要配置路径别名，当遇到<code>imoprt {xxx} from 'antd-design-vue'</code>的时候，指向到 <code>import {xxx} from 'ant-design-vue/dist/antd.min.js</code></p> <p>vite.config.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    resolve<span class="token punctuation">:</span><span class="token punctuation">{</span>
        alias<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>find<span class="token punctuation">:</span> <span class="token regex">/ant-design-vue$/</span><span class="token punctuation">,</span>replacement<span class="token punctuation">:</span> <span class="token string">'ant-design-vue/dist/antd.min'</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>注意，当这样改了过后就不要再使用按需导入的插件了，只有引入编译后的代码才能解决这个错误，只能全量引入，在开发环境下，全量导入也是能接受的</strong></p> <p>另外，全量引入后，记得手动引入<code>ant-design-vue</code>的样式文件</p> <h3 id="四、vue模版编译出现多余的空格字符"><a href="#四、vue模版编译出现多余的空格字符" aria-hidden="true" class="header-anchor">#</a> 四、vue模版编译出现多余的空格字符</h3> <p>此问题可能导致页面内容错位，因为Dom结构中会出现多余的空白字符，导致文本内容间出现分隔、行内标签间出现空格。而<code>vue-cli</code>中默认是对模版编译选项中配置了对空格的处理选项，而<code>vite-plugin-vue2</code>是没有默认配置的，就导致默认情况下与<code>webpack</code>版<code>vue-cli</code>环境下的配置有所差异。详见此<a href="https://github.com/underfin/vite-plugin-vue2/pull/62" target="_blank" rel="noopener noreferrer">issue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>解决方案：</p> <p>vite.config.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createVuePlugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite-plugin-vue2&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token function">createVuePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            jsx<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            vueTemplateOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                compilerOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                  whitespace<span class="token punctuation">:</span> <span class="token string">&quot;condense&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
     <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="五、require-context在vite环境下无法使用"><a href="#五、require-context在vite环境下无法使用" aria-hidden="true" class="header-anchor">#</a> 五、require.context在vite环境下无法使用</h3> <p><code>require.context</code>是webpack独有的语法，用于创建一个require上下文，通常用于批量导入模块。然而在<code>vite</code>中根本不支持<code>require</code>，所有的模块导入都必须使用<code>import</code>，所以<code>vite</code>中也提供了一个用于批量导入的<a href="https://cn.vitejs.dev/guide/features.html#glob-import" target="_blank" rel="noopener noreferrer">glob导入<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>功能</p> <p><strong>import.meta.glob</strong></p> <p>用于动态的导入多个模块（懒加载），且每个模块在构建时被分离为单独的chunk。例：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">glob</span><span class="token punctuation">(</span><span class="token string">'./dir/*.js'</span><span class="token punctuation">)</span>

<span class="token comment">// 以上语句会被转译为如下的样子：</span>

<span class="token operator">/</span><span class="token operator">/</span> vite 生成的代码
<span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'./dir/foo.js'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./dir/foo.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'./dir/bar.js'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./dir/bar.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>import.meta.globEager</strong></p> <p>用于静态的导入多个模块，例：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">glob</span><span class="token punctuation">(</span><span class="token string">'./dir/*.js'</span><span class="token punctuation">)</span>

<span class="token comment">// 以上语句会被转译为如下的样子：</span>

<span class="token operator">/</span><span class="token operator">/</span> vite 生成的代码
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> __glob__0_0 <span class="token keyword">from</span> <span class="token string">'./dir/foo.js'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> __glob__0_1 <span class="token keyword">from</span> <span class="token string">'./dir/bar.js'</span>
<span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'./dir/foo.js'</span><span class="token punctuation">:</span> __glob__0_0<span class="token punctuation">,</span>
  <span class="token string">'./dir/bar.js'</span><span class="token punctuation">:</span> __glob__0_1
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>无论是批量动态导入还是批量静态导入，返回的都是一个对象，其中的<code>key</code>是该模块的所处路径，value是一个动态加载模块的函数或者直接就是一个导入的模块。而<code>require.context</code>返回的则是一个函数，所以在将<code>require.context</code>替换为<code>glob导入</code>时还需要注意获取获取导入的模块的方式改变。</p> <p>由于与<code>require.context</code>的差异，所以在webpack环境中与在vite环境中无法使用通用的处理逻辑，最近我发现了一个<code>babel</code>插件<a href="https://www.npmjs.com/package/babel-plugin-transform-vite-meta-glob" target="_blank" rel="noopener noreferrer">babel-plugin-transform-vite-meta-glob<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，可以直接在webpack环境中使用<code>glob导入</code>方式，此插件会将其转译为与vite中相同的处理方式，这样的话可保持vite环境与webpack环境下批量导入模块的代码一致，例：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">glob</span><span class="token punctuation">(</span><span class="token string">'./path/to/files/**/*'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> eagerModules <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">globEager</span><span class="token punctuation">(</span><span class="token string">'./path/to/files/**/*'</span><span class="token punctuation">)</span>

<span class="token comment">// 以上代码会转译为如下这样</span>

<span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'./path/to/files/file1.js'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./path/to/files/file1.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'./path/to/files/file2.js'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'./path/to/files/file2.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'./path/to/files/file3.js'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'./path/to/files/file3.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> eagerModules <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'./path/to/files/file1.js'</span><span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./path/to/files/file1.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'./path/to/files/file2.js'</span><span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./path/to/files/file2.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'./path/to/files/file3.js'</span><span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./path/to/files/file3.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="六、svg-icon如何使用"><a href="#六、svg-icon如何使用" aria-hidden="true" class="header-anchor">#</a> 六、Svg Icon如何使用</h3> <p>在webpack中使用svg icon,一般都是采用<a href="https://github.com/JetBrains/svg-sprite-loader" target="_blank" rel="noopener noreferrer">svg-sprite-loader<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>去做处理，方便直接在代码使用。而vite下也有一个类似的插件<a href="https://github.com/anncwb/vite-plugin-svg-icons/blob/main/README.zh_CN.md" target="_blank" rel="noopener noreferrer">vite-plugin-svg-icons<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,配置与<code>svg-sprite-loader</code>类似</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createVuePlugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite-plugin-vue2&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> viteSvgIcons <span class="token keyword">from</span> <span class="token string">&quot;vite-plugin-svg-icons&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token function">createVuePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      jsx<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      vueTemplateOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        compilerOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          whitespace<span class="token punctuation">:</span> <span class="token string">&quot;condense&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">viteSvgIcons</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      iconDirs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src/icon/svg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      symbolId<span class="token punctuation">:</span> <span class="token string">&quot;icon-[name]&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>然后在项目入口的js文件中，添加一个模块引入：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token operator">...</span>
<span class="token keyword">import</span> <span class="token string">&quot;vite-plugin-svg-icons/register&quot;</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>大功告成，接下来即可像在webpack环境中使用<strong>svg icon</strong>一样尽情享用了。</p> <h3 id="七、别名配置"><a href="#七、别名配置" aria-hidden="true" class="header-anchor">#</a> 七、别名配置</h3> <p>vite中同样支持与webpack类似的别名系统</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> defineConfig <span class="token punctuation">{</span>
  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.mjs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.ts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.jsx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.tsx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.json&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    alias<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token operator">...</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>aliasConfig<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
        find<span class="token punctuation">:</span> key<span class="token punctuation">,</span>
        replacement<span class="token punctuation">:</span> aliasConfig<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> find<span class="token punctuation">:</span> <span class="token string">&quot;timers&quot;</span><span class="token punctuation">,</span> replacement<span class="token punctuation">:</span> <span class="token string">&quot;timers-browserify&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> find<span class="token punctuation">:</span> <span class="token regex">/ant-design-vue$/</span><span class="token punctuation">,</span> replacement<span class="token punctuation">:</span> <span class="token string">&quot;ant-design-vue/dist/antd.min&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>这里我是将别名配置抽出为一份公共的配置文件，以备webpack和vite使用一份相同的别名配置：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// aliasConfig

const {resolve} = require('path');
module.exports = {
  &quot;@&quot;: resolve(__dirname, &quot;src&quot;),
  static: resolve(__dirname, &quot;public/static&quot;),
  YZT: resolve(__dirname, &quot;src/views/YZT&quot;),
  FZSC: resolve(__dirname, &quot;src/views/FZSC&quot;),
  JCYJ: resolve(__dirname, &quot;src/views/JCYJ&quot;),
  GHSS: resolve(__dirname, &quot;src/views/GHSS&quot;),
  FZBZ: resolve(__dirname, &quot;src/views/FZBZ&quot;),
  ZBMX: resolve(__dirname, &quot;src/views/ZBMX&quot;),
  YWXT: resolve(__dirname, &quot;src/views/YWXT&quot;),
  MXXT: resolve(__dirname, &quot;src/views/MXXT&quot;),
  JDGL: resolve(__dirname, &quot;src/views/JDGL&quot;),
  JDTB: resolve(__dirname, &quot;src/views/JDTB&quot;)
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="剩余待解决问题"><a href="#剩余待解决问题" aria-hidden="true" class="header-anchor">#</a> 剩余待解决问题</h2> <ol><li>vue中script标签中增加<code>lang=&quot;jsx&quot;</code>标识后，更改代码无法实现热更新,关联<a href="https://github.com/vitejs/vite/issues/3008" target="_blank" rel="noopener noreferrer">issue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>vue中script标签增加<code>lang=&quot;jsx&quot;</code>标识后，无法使用vetur格式化，关联<a href="https://github.com/vuejs/vetur/issues/2781" target="_blank" rel="noopener noreferrer">issue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>热更新状态丢失，关于这个问题，我搜了很多issue，但都没找到有类似问题的记录，并且我使用demo做测试时也并不能复现问题，但是实际应用在项目，就确实会出现这个问题，还没有找到头绪</li> <li>某些依赖包由于内部使用了<code>require</code>导入的语法，导致vite不能成功将其转化为es模块，在运行时会报错。</li></ol> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>现在我的项目已经能成功使用vite启动起来了，但实际感受下来，在项目启动速度上并没有质的改变，因为项目过大，初次启动时通过网络请求加载模块的数量也非常非常多，导致速度并没有明显提升。但是在热更新方面，确实如尤大所说：速度快到惊人。</p> <p>现在基于vite成功应用在生产环境中的案例也还比较少，遇到些问题都还得自己探索，但不可否认，vite提供了一种与webpack完全不同的方式，并且在编译和热更新速度上有较大的优势，期望能尽快完善vite相关的体系，能更加便捷的应用在项目中。</p> <p>大家平时可以多关注下这个项目：<a href="https://github.com/vitejs/awesome-vite" target="_blank" rel="noopener noreferrer">awesome-vite<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，里面有很多推荐的插件集合和各种不同技术栈使用vite的示例项目，遇到问题时可以提供一些解决思路。</p></div> <!----> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6/16/2021, 9:40:42 AM</span></div></footer> <!----> </main> <div class="valine-wrapper" data-v-0162251c><div id="valine" data-v-0162251c></div></div></div> <div class="back-to-ceiling" style="right:1rem;bottom:3rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;background-color:rgba(231, 234, 241,.5);display:none;" data-v-d0bfeaa4 data-v-d0bfeaa4><i class="iconfont reco-up" data-v-d0bfeaa4></i></div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.32a77fa1.js" defer></script><script src="/assets/js/5.3db1e33a.js" defer></script><script src="/assets/js/1.1263133a.js" defer></script><script src="/assets/js/31.23b894b7.js" defer></script>
  </body>
</html>
